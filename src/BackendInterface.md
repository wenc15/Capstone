# Growin 后端接口文档（面向前端）

默认服务地址示例：`http://localhost:5024`（端口以实际运行为准）  
所有接口默认使用 `Content-Type: application/json`。

- 专注会话相关接口开发者：**Chiyu Huang（Team 31 后端）**
- 用户 Profile 相关接口开发者：**Zikai Lu（Team 31 后端）**
- 宠物成长值接口开发者：**Zikai Lu（Team 31 后端）**
- 背包接口开发者：**Zikai Lu（Team 31 后端）**
- 白名单预设相关接口开发者：**Zikai Lu（Team 31 后端）**

---

## 1. 专注会话相关接口（/api/focus）

> 开发者：**Chiyu Huang**

### 1.1 开始专注

- **方法**：`POST`
- **路径**：`/api/focus/start`
- **功能**：启动一次新的专注会话，设置本次时长、白名单应用和宽限时间。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**

| 字段             | 类型     | 必填 | 说明                                                                 |
| ---------------- | -------- | ---- | -------------------------------------------------------------------- |
| `durationSeconds`  | number   | 是   | 专注总时长（秒）。                                                   |
| `allowedProcesses` | string[] | 是   | 白名单应用进程名列表，例如 `chrome.exe`、`Code.exe`。               |
| `graceSeconds`     | number   | 否   | 违规宽限时间（秒），不传或 ≤ 0 时后端使用默认 10 秒。               |

- **响应**
  - `200 OK`：启动成功，响应体为空或仅包含调试信息。
  - `400 Bad Request`：请求体字段不合法。

---

### 1.2 查看专注状态

- **方法**：`GET`
- **路径**：`/api/focus/status`
- **功能**：查询当前专注会话的状态。前端可以按固定时间间隔轮询此接口，用于更新倒计时和违规提示。
- **请求体**：无
- **响应体字段**（`FocusStatusResponse`）

| 字段               | 类型    | 说明                                                                 |
| ------------------ | ------- | -------------------------------------------------------------------- |
| `isRunning`        | boolean | 是否有专注会话正在进行。                                            |
| `remainingSeconds` | number  | 本次专注剩余秒数。                                                   |
| `isFailed`         | boolean | 当前会话是否已经被判定为失败。                                      |
| `failReason`       | string  | 失败原因描述（例如使用了哪个程序），未失败时为空或 `null`。        |
| `isViolating`      | boolean | 当前这一秒是否处于“违规计时中”（宽限时间内使用非白名单应用）。     |
| `violationSeconds` | number  | 当前这一轮违规已经持续了多少秒。                                    |
| `currentProcess`   | string  | 当前前台窗口所属进程名（如 `chrome`）；无法获取时为空或 `null`。    |

- **响应状态码**
  - `200 OK`：返回当前状态。

---

### 1.3 停止专注

- **方法**：`POST`
- **路径**：`/api/focus/stop`
- **功能**：用户主动停止当前专注会话。该会话在统计中计为“取消的会话（Aborted）”，会更新总会话数和总时长，但不计入成功或失败。
- **请求头**：
  - `Content-Type: application/json`
- **请求体**：空对象即可（可以为 `{}`）。
- **响应**
  - `200 OK` 或 `204 No Content`：停止成功。
  - 若当前没有正在进行的会话，一般也返回成功但不做任何操作。

---

## 2. 用户 Profile 接口（/api/profile）

> 开发者：**Zikai Lu**

### 2.1 获取用户专注统计信息

- **方法**：`GET`
- **路径**：`/api/profile`
- **功能**：读取用户累计专注统计信息，用于个人中心 / Dashboard 等页面展示。
- **请求体**：无
- **响应体字段**（`UserProfile`）

| 字段                  | 类型   | 说明                                                                 |
| --------------------- | ------ | -------------------------------------------------------------------- |
| `totalFocusSeconds`   | number | 累计专注时长（秒），包含成功 / 失败 / 取消会话的时间总和。          |
| `totalSessions`       | number | 总会话数 = 成功会话数 + 失败会话数 + 取消会话数。                    |
| `successfulSessions`  | number | 成功会话数（计时自然结束且未被判定失败）。                           |
| `failedSessions`      | number | 失败会话数（超出宽限时间使用非白名单应用等原因导致的失败）。         |
| `canceledSessions`    | number | 取消会话数（用户主动点击“停止专注”的次数）。                         |
| `petGrowth`           | number[] | 宠物成长值列表，索引即宠物编号（从 0 开始）；默认 0，预留 -1 表示未拥有。 |
| `inventory`           | object<string,int> | 背包物品与数量的键值对，未包含的物品视为 0。 |

- **响应状态码**
  - `200 OK`：返回当前用户的统计信息。

---

## 3. 宠物成长值接口（/api/pets/{petId}/growth）

> 开发者：**Zikai Lu**

成长值规则说明：

- `petId` 从 0 开始编号。
- 成长值为整数，减少时最低为 0。
- 预留 `-1` 作为“未拥有”的标记（未来可能启用）。

### 3.1 查询指定宠物成长值

- **方法**：`GET`
- **路径**：`/api/pets/{petId}/growth`
- **功能**：查询指定宠物的当前成长值。
- **请求体**：无
- **响应体字段**（`PetGrowthResponse`）

| 字段     | 类型   | 说明                     |
| -------- | ------ | ------------------------ |
| `petId`  | number | 宠物编号（从 0 开始）。 |
| `growth` | number | 当前成长值。            |

- **响应状态码**
  - `200 OK`：返回指定宠物的成长值。
  - `400 Bad Request`：`petId` 为负数。

---

### 3.2 增加指定宠物成长值

- **方法**：`POST`
- **路径**：`/api/pets/{petId}/growth/add`
- **功能**：增加指定宠物的成长值。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`PetGrowthAmountRequest`）

| 字段     | 类型   | 必填 | 说明                       |
| -------- | ------ | ---- | -------------------------- |
| `amount` | number | 是   | 要增加的成长值，必须为正数 |

- **响应体字段**（`PetGrowthResponse`）

| 字段     | 类型   | 说明                     |
| -------- | ------ | ------------------------ |
| `petId`  | number | 宠物编号（从 0 开始）。 |
| `growth` | number | 增加后的成长值。        |

- **响应状态码**
  - `200 OK`：增加成功。
  - `400 Bad Request`：`petId` 为负数或 `amount` 不是正数。

---

### 3.3 减少指定宠物成长值

- **方法**：`POST`
- **路径**：`/api/pets/{petId}/growth/consume`
- **功能**：减少指定宠物的成长值，低于 0 时会被截断为 0。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`PetGrowthAmountRequest`）

| 字段     | 类型   | 必填 | 说明                       |
| -------- | ------ | ---- | -------------------------- |
| `amount` | number | 是   | 要减少的成长值，必须为正数 |

- **响应体字段**（`PetGrowthResponse`）

| 字段     | 类型   | 说明                     |
| -------- | ------ | ------------------------ |
| `petId`  | number | 宠物编号（从 0 开始）。 |
| `growth` | number | 减少后的成长值。        |

- **响应状态码**
  - `200 OK`：减少成功。
  - `400 Bad Request`：`petId` 为负数或 `amount` 不是正数。

---

## 4. 背包接口（/api/inventory）

> 开发者：**Zikai Lu**

背包规则说明：

- 背包默认为空；未包含的物品视为数量 0。
- 物品数量为整数，消耗时库存不得为负。

### 4.1 查询背包全部物品

- **方法**：`GET`
- **路径**：`/api/inventory`
- **功能**：返回背包内所有物品及其数量。
- **请求体**：无
- **响应体字段**（`InventoryResponse`）

| 字段    | 类型              | 说明               |
| ------- | ----------------- | ------------------ |
| `items` | object<string,int> | 物品与数量的键值对 |

- **响应状态码**
  - `200 OK`：返回背包物品列表（可能为空对象）。

---

### 4.2 增加指定物品数量

- **方法**：`POST`
- **路径**：`/api/inventory/add`
- **功能**：增加指定物品的数量。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`InventoryAmountRequest`）

| 字段     | 类型   | 必填 | 说明                         |
| -------- | ------ | ---- | ---------------------------- |
| `itemId` | string | 是   | 物品 id（如 `testObject1`） |
| `amount` | number | 是   | 要增加的数量，必须为正数     |

- **响应体字段**（`InventoryResponse`）

| 字段    | 类型              | 说明               |
| ------- | ----------------- | ------------------ |
| `items` | object<string,int> | 增加后的背包内容   |

- **响应状态码**
  - `200 OK`：增加成功。
  - `400 Bad Request`：`itemId` 为空或 `amount` 不是正数。

---

### 4.3 消耗指定物品数量

- **方法**：`POST`
- **路径**：`/api/inventory/consume`
- **功能**：消耗指定物品数量，库存不足时返回错误。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`InventoryAmountRequest`）

| 字段     | 类型   | 必填 | 说明                         |
| -------- | ------ | ---- | ---------------------------- |
| `itemId` | string | 是   | 物品 id（如 `testObject1`） |
| `amount` | number | 是   | 要消耗的数量，必须为正数     |

- **成功响应体字段**（`InventoryResponse`）

| 字段    | 类型              | 说明               |
| ------- | ----------------- | ------------------ |
| `items` | object<string,int> | 消耗后的背包内容   |

- **失败响应体字段**（`400 Bad Request` 时）

| 字段           | 类型   | 说明               |
| -------------- | ------ | ------------------ |
| `message`      | string | 错误信息（如 `insufficient inventory.`）。 |
| `currentCount` | number | 当前库存数量。     |

- **响应状态码**
  - `200 OK`：消耗成功。
  - `400 Bad Request`：`itemId` 为空、`amount` 非正数，或库存不足。

---

## 5. 点数系统接口（/api/credits）

> 开发者：**Zikai Lu**

点数的基础规则：

- 每次专注会话结束时，系统根据本次实际专注时长 `focusSeconds` 奖励点数：
  - `credits += ceil(focusSeconds / 60)`
  - 例如：5 分 01 秒 → 6 点；0 分 10 秒 → 1 点（若本次有时长）。
- 点数同时可以通过接口手动增加或消耗，供抽奖系统、商店系统等使用。

### 5.1 查询当前点数

- **方法**：`GET`
- **路径**：`/api/credits`
- **功能**：读取当前点数余额。
- **请求体**：无
- **响应体字段**（`CreditBalanceResponse`）

| 字段       | 类型   | 说明         |
| ---------- | ------ | ------------ |
| `credits`  | number | 当前点数余额 |

- **响应状态码**
  - `200 OK`：返回当前点数余额。

---

### 5.2 增加指定数量的点数

- **方法**：`POST`
- **路径**：`/api/credits/add`
- **功能**：增加指定数量的点数，可用于管理员操作、活动奖励等场景。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`CreditAmountRequest`）

| 字段      | 类型   | 必填 | 说明                          |
| --------- | ------ | ---- | ----------------------------- |
| `amount`  | number | 是   | 要增加的点数数量，必须为正数 |

- **响应体字段**（`CreditBalanceResponse`）

| 字段      | 类型   | 说明               |
| --------- | ------ | ------------------ |
| `credits` | number | 增加后的点数余额。 |

- **响应状态码**
  - `200 OK`：增加成功。
  - `400 Bad Request`：`amount` 缺失或不是正数。

---

### 5.3 消耗指定数量的点数

- **方法**：`POST`
- **路径**：`/api/credits/consume`
- **功能**：消耗指定数量的点数，用于抽奖系统、商店系统等。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`CreditAmountRequest`）

| 字段      | 类型   | 必填 | 说明                          |
| --------- | ------ | ---- | ----------------------------- |
| `amount`  | number | 是   | 要消耗的点数数量，必须为正数 |

- **成功响应体字段**（`CreditBalanceResponse`）

| 字段      | 类型   | 说明               |
| --------- | ------ | ------------------ |
| `credits` | number | 消耗后的点数余额。 |

- **失败响应体字段**（`400 Bad Request` 时）

| 字段             | 类型   | 说明                          |
| ---------------- | ------ | ----------------------------- |
| `message`        | string | 错误信息（如 `insufficient credits.`）。 |
| `currentCredits` | number | 当前点数余额。               |

- **响应状态码**
  - `200 OK`：消耗成功。
  - `400 Bad Request`：`amount` 非正数，或余额不足。

---

## 6. 白名单预设接口（/api/whitelistpresets）

> 开发者：**Zikai Lu**

### 6.1 获取所有白名单预设

- **方法**：`GET`
- **路径**：`/api/whitelistpresets`
- **功能**：读取本地保存的所有白名单预设，用于前端预设列表选择和管理。
- **请求体**：无
- **响应体类型**：`WhitelistPreset[]`（数组）
- **单个预设字段**（`WhitelistPreset`）

| 字段               | 类型     | 说明                                       |
| ------------------ | -------- | ------------------------------------------ |
| `id`               | string   | 预设唯一标识（Guid 字符串）。             |
| `name`             | string   | 预设名称。                                 |
| `allowedProcesses` | string[] | 该预设的白名单应用进程列表。              |
| `allowedWebsites`  | string[] | 该预设的白名单网站列表。                  |
| `createdAt`        | string   | 创建时间（ISO8601 格式，UTC）。           |
| `updatedAt`        | string   | 最后修改时间（ISO8601 格式，UTC）。       |

- **响应状态码**
  - `200 OK`：返回预设列表（可能为空数组）。

---

### 6.2 保存白名单预设（创建 / 更新）

- **方法**：`POST`
- **路径**：`/api/whitelistpresets`
- **功能**：将当前白名单配置保存为预设。若携带已有 `id` 或 `name`，可以更新对应预设，否则创建新预设。
- **请求头**：
  - `Content-Type: application/json`
- **请求体字段**（`SaveWhitelistPresetRequest`）

| 字段               | 类型     | 必填 | 说明                                                                 |
| ------------------ | -------- | ---- | -------------------------------------------------------------------- |
| `id`               | string   | 否   | 更新已有预设时使用：传已有预设的 `id`；不传则视为新建或按 `name` 覆盖。 |
| `name`             | string   | 否   | 预设名称；为空时后端会生成一个默认名称（带时间）。                  |
| `allowedProcesses` | string[] | 是   | 白名单应用列表。                                                     |
| `allowedWebsites`  | string[] | 是   | 白名单网站列表。                                                     |

- **保存行为规则**

1. 若 `id` 有值：按 `id` 查找并更新对应预设（若找不到则创建新预设）。
2. 若 `id` 为空、`name` 有值：按名称（不区分大小写）查找同名预设，有则更新该预设，没有则创建新预设。
3. 若 `id` 为空且 `name` 为空：一定创建新预设，名称由后端生成，格式类似 `Preset yyyy-MM-dd HH:mm`。

- **响应体**
  - 类型为单个 `WhitelistPreset`，为保存后的最终数据（包含 `id`、时间戳等）。

- **响应状态码**
  - `200 OK`：保存成功，返回完整预设对象。
  - `400 Bad Request`：请求体字段不合法（例如缺少必填列表字段）。

---

### 6.3 删除白名单预设

- **方法**：`DELETE`
- **路径**：`/api/whitelistpresets/{id}`
- **功能**：删除指定 `id` 的白名单预设。
- **路径参数**

| 参数 | 类型   | 说明             |
| ---- | ------ | ---------------- |
| `id` | string | 预设的唯一标识。 |

- **请求体**：无
- **响应状态码**
  - `204 No Content`：删除成功。
  - `404 Not Found`：未找到对应 `id` 的预设（可能已被删除或 `id` 不存在）。

---

## 7. 默认模板接口（仅调试用）

> 开发者：模板自动生成（非业务接口）

### 7.1 WeatherForecast 示例

- **方法**：`GET`
- **路径**：`/weatherforecast`
- **功能**：ASP.NET Core 默认模板生成的示例接口，用于确认后端服务是否正常运行。  
  不参与业务逻辑，前端可按需忽略。

- **请求体**：无
- **响应体**：若控制器未被删除，则返回一组示例天气数据结构（内容固定，仅供调试使用）。
